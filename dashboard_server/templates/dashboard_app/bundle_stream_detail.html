{% extends "base.html" %}
{% load i18n %}
{% load humanize %}


{% block title %}
| {% trans "Streams" %}
| {% trans "Bundle Stream" %} {{ bundle_stream.pathname }}
{% endblock %}


{% block breadcrumbs %}
<li><a href="{% url dashboard_app.views.bundle_stream_list %}">{% trans "Bundle Streams" %}</a></li>
<li>{{ bundle_stream.pathname }}</li>
{% endblock %}


{% block sidebar %}
<dl>
  <dt>{% trans "Pathname:" %}</dt>
  <dd>{{ bundle_stream.pathname }}</dd>
  <dt>{% trans "Access rights:" %}</dt>
  <dd>
  {% if bundle_stream.user %}
  This stream is private to {{ bundle_stream.user.username }}
  {% else %}
  {% if bundle_stream.group %}
  This stream is shared by group called {{ bundle_stream.group }}
  {% else %}
  {% blocktrans %}This stream is public{% endblocktrans %}
  {% endif %}
  {% endif %}
  </dd>
  <dt>{% trans "Name:" %}</dt>
  <dd>{{ bundle_stream.name|default:"<i>not set</i>" }}</dd>
</dl>
{% endblock %}


{% block content %}

{% if bundle_stream.bundles.count %}
<table class="data">
  <tr>
    <th rowspan="3">{% trans "Uploaded By" %}</th>
    <th rowspan="3">{% trans "Uploaded On" %}</th>
    <th style="width: 70%" colspan="5">{% trans "Analysis" %}</th>
  </tr>
  <tr>
    <th rowspan="2">{% trans "Test" %}</th>
    <th colspan="4">{% trans "Test Results" %}</th>
  </tr>
  <tr>
    <th>{% trans "Pass" %}</th>
    <th>{% trans "Fail" %}</th>
    <th>{% trans "Skip" %}</th>
    <th>{% trans "Unknown" %}</th>
  </tr>
  {% for bundle in bundle_stream.bundles.all %}
  <tr>
    <td>{{ bundle.uploaded_by|default:"<i>anonymous</i>" }}</td>
    <td>{{ bundle.uploaded_on|naturalday }} {{ bundle.uploaded_on|time }}</td>
    {% if bundle.is_deserialized %}
    <td>
      {% ifequal bundle.test_runs.count 1 %}
      {{ bundle.get_test_if_exactly_one_test_run }}
      {% else %}
      <em>{% trans "multiple" %}</em>: {{ bundle_test_runs.count }}
      {% endifequal %}
    </td>
    {% with bundle.get_summary_results as summary %}
    <td>{{ summary.pass|default:0 }}</td>
    <td>{{ summary.fail|default:0 }}</td>
    <td>{{ summary.skip|default:0 }}</td>
    <td>{{ summary.unknown|default:0 }}</td>
    {% endwith %}
    {% else %}
    <td style="text-align: center" colspan="5">
      {% if bundle.deserialization_error.count %}
      {% trans "deserialization failed" %}
      <span class="deserialization_failure_reason"
        title="{{ bundle.deserialization_error.get.error_message }}"
        >(learn why)</span>
      {% else %}
      {% trans "not deserialized yet" %}
      {% endif %}
    </td>
    {% endif %}
  </tr>
  {% endfor %}
</table>

{% else %}

<p>{% blocktrans %}
  There are no bundles in this stream yet.
{% endblocktrans %}</p>

{% endif %}

{% endblock %}
